"use strict";function _typeof(e){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_typeof(e)}!function(e){function t(){e(".emsh-sortable-wrap").sortable("instance")?e(".emsh-sortable-wrap").sortable("refresh"):e(".emsh-sortable-wrap").sortable({axis:"y",items:".emsh-single-sortable-item:not(.counter-0)"})}function n(e){return null!==e&&("function"==typeof e||"object"===_typeof(e))}function s(){e('input[type=submit][name="publish"]').length?e('input[type=submit][name="publish"]').click():e('input[type=submit][name="save"]').click()}e(document).ready((function(){var n=e('.toplevel_page_emsh ul li a[href="admin.php?page=emsh-template-group-category"]');n.length&&n.attr("href").includes("category")&&n.attr("href","edit-tags.php?taxonomy=emsh-template-group-category&post_type=emsh-template-groups"),t(),e.fn.selectWoo&&e(".emsh_multiple").selectWoo()})),e(document).on("change",".template_type_selector select",(function(t){var n=this.value,s=e(this).closest(".emsh-admin");s.find(".form-group:not(.template_type_selector)").hide(),"specific_cats"===n?s.find(".category_selector").show():"specific_templates"===n&&s.find(".template_selector").show()})),e(document).on("click","button.license-generator",(function(t){t.preventDefault();var n=function(e){for(var t="",n="0123456789abcdefghijklmnopqrstuvwxyz",s=0;s<e;s++)t+=n[Math.floor(Math.random()*n.length)];return CryptoJS.MD5("emsh"+(new Date).getTime()+t).toString()}(16);e(this).parent().find("#license_key").val(n)})),e(document).on("click",".cpy-btn",(function(t){t.preventDefault();var n=e(this).parent().find("#license_key"),s=n.val();n[0].focus(),n[0].select(),navigator.clipboard.writeText(s)})),e(document).on("click",".connect-btn",(function(t){t.preventDefault();var i=e(this);if(e(".emsh-notice").hide(),""===i.attr("data-status")||"notconnected"===i.attr("data-status")){if(e("#emsh_site_license_key").val()&&e("#emsh_site_url").val()){i.html(i.attr("data-connecting"));var a={action:"emsh_connect",license_key:e("#emsh_site_license_key").val(),site_url:e("#emsh_site_url").val()};i.attr("disabled",!0),e.post(ajaxurl,a,(function(t){t&&"success"in t&&t.success?(i.html(i.attr("data-disconnect")),i.attr("data-status","connected"),e(".emsh-notice").hide(),e(".emsh-notice.notice-success").html(t.message).show(),e('input[name="emsh_connection_status"]').val("connected"),"expiry_date"in t&&e('input[name="emsh_site_expiry_date"]').val(t.expiry_date),s()):(i.html(i.attr("data-connect")),i.attr("data-status","notconnected"),n(t)&&"message"in t&&(e(".emsh-notice").hide(),e(".emsh-notice.notice-error").html(t.message).show()),e('input[name="emsh_connection_status"]').val("notconnected")),i.attr("disabled",!1)}))}}else if(e("#emsh_site_license_key").val()&&e("#emsh_site_url").val()){i.html(i.attr("data-disconnecting"));a={action:"emsh_disconnect",license_key:e("#emsh_site_license_key").val(),site_url:e("#emsh_site_url").val()};i.attr("disabled",!0),e.post(ajaxurl,a,(function(t){t&&"success"in t&&t.success?(i.html(i.attr("data-connect")),i.attr("data-status","notconnected"),e(".emsh-notice").hide(),e(".emsh-notice.notice-success").html(t.message).show(),e('input[name="emsh_connection_status"]').val("notconnected"),e('input[name="emsh_site_expiry_date"]').val(""),s()):(i.html(i.attr("data-disconnect")),i.attr("data-status","connected"),n(t)&&"message"in t&&(e(".emsh-notice").hide(),e(".emsh-notice.notice-error").html(t.message).show()),e('input[name="emsh_connection_status"]').val("connected")),i.attr("disabled",!1)}))}})),e(document).on("click",".server-disconnect",(function(t){if(t.preventDefault(),confirm(emsh_admin.areyousure)&&e("#license_key").val()){e(".emsh-notice").hide();var i=e(this),a={action:"emsh_revoke_site",site_url:i.parent().find("a").html(),license_key:e("#license_key").val()};i.attr("disabled",!0),e.post(ajaxurl,a,(function(t){t&&"success"in t&&t.success?s():(e(".emsh-notice").hide(),n(t)&&"message"in t&&e(".emsh-notice.notice-error").html(t.message).show()),i.attr("disabled",!1)}))}})),e(document).on("click",".server-block.disabled",(function(e){e.preventDefault()})),e(document).on("click",".server-block:not(.disabled)",(function(t){if(t.preventDefault(),confirm(emsh_admin.areyousure)&&e("#license_key").val()){e(".emsh-notice").hide();var i=e(this),a={action:"emsh_block_site",site_url:i.parent().find("a").html(),license_key:e("#license_key").val()};i.attr("disabled",!0),e.post(ajaxurl,a,(function(t){t&&"success"in t&&t.success?s():(e(".emsh-notice").hide(),n(t)&&"message"in t&&e(".emsh-notice.notice-error").html(t.message).show()),i.attr("disabled",!1)}))}})),e(document).on("click",".server-unblock",(function(t){if(t.preventDefault(),confirm(emsh_admin.areyousure)&&e("#license_key").val()){e(".emsh-notice").hide();var i=e(this),a={action:"emsh_unblock_site",site_url:i.parent().find("a").html(),license_key:e("#license_key").val()};i.attr("disabled",!0),e.post(ajaxurl,a,(function(t){t&&"success"in t&&t.success?s():(e(".emsh-notice").hide(),n(t)&&"message"in t&&e(".emsh-notice.notice-error").html(t.message).show()),i.attr("disabled",!1)}))}})),e(document).on("click",".addsortableitem",(function(n){n.preventDefault();var s=e(this).parent().find(".emsh-single-sortable-item:last").clone();s.appendTo(e(".emsh-sortable-wrap")).removeClass("counter-0").find(".url-data a").hide(),s.find(".tg-delete-item").show(),s.find("input").val(""),t()})),e(document).on("change","#emsh_template_group_templates",(function(t){e(this).parent().find(".url-data a").hide(),e(this).parent().find(".url-data a[data-id="+this.value+"]").show()})),e(document).on("click",".tg-delete-item",(function(t){t.preventDefault(),confirm(emsh_admin.areyousure)&&e(this).closest(".emsh-single-sortable-item").remove()}))}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFkbWluLmpzIl0sIm5hbWVzIjpbIl90eXBlb2YiLCJvYmoiLCJTeW1ib2wiLCJpdGVyYXRvciIsImNvbnN0cnVjdG9yIiwicHJvdG90eXBlIiwiJCIsImluaXRTb3J0YWJsZSIsInNvcnRhYmxlIiwiYXhpcyIsIml0ZW1zIiwiaXNPYmplY3QiLCJ2YWwiLCJjbGlja19vbl9zYXZlX29yX3B1Ymxpc2giLCJsZW5ndGgiLCJjbGljayIsImRvY3VtZW50IiwicmVhZHkiLCIkZWwiLCJhdHRyIiwiaW5jbHVkZXMiLCJmbiIsInNlbGVjdFdvbyIsIm9uIiwiZSIsInZhbHVlIiwidGhpcyIsIiRhZG1pbiIsImNsb3Nlc3QiLCJmaW5kIiwiaGlkZSIsInNob3ciLCJwcmV2ZW50RGVmYXVsdCIsIm5ld0xpY2Vuc2UiLCJyZXN1bHQiLCJjaGFyYWN0ZXJzIiwiaSIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsIkNyeXB0b0pTIiwiTUQ1IiwiRGF0ZSIsImdldFRpbWUiLCJ0b1N0cmluZyIsImdlbkxpY2Vuc2UiLCJwYXJlbnQiLCIkaW5wdXQiLCJsaWNlbnNlIiwiZm9jdXMiLCJzZWxlY3QiLCJuYXZpZ2F0b3IiLCJjbGlwYm9hcmQiLCJ3cml0ZVRleHQiLCIkdGhpcyIsImh0bWwiLCJkYXRhIiwiYWN0aW9uIiwibGljZW5zZV9rZXkiLCJzaXRlX3VybCIsInBvc3QiLCJhamF4dXJsIiwicmVzcG9uc2UiLCJzdWNjZXNzIiwibWVzc2FnZSIsImV4cGlyeV9kYXRlIiwiY29uZmlybSIsImVtc2hfYWRtaW4iLCJhcmV5b3VzdXJlIiwiJG5ld0VsZW1lbnQiLCJjbG9uZSIsImFwcGVuZFRvIiwicmVtb3ZlQ2xhc3MiLCJyZW1vdmUiLCJqUXVlcnkiXSwibWFwcGluZ3MiOiJBQUFBLGFBRUEsU0FBU0EsUUFBUUMsR0FBa0MsT0FBT0QsUUFBVSxtQkFBcUJFLFFBQVUsaUJBQW1CQSxPQUFPQyxTQUFXLFNBQVVGLEdBQU8sY0FBY0EsQ0FBSyxFQUFJLFNBQVVBLEdBQU8sT0FB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ckN4QixFQUFFb0IsTUFBTW9CLFNBQVNqQixLQUFLLHVCQUF1QkgsS0FBS0QsTUFBTSxLQUFLTSxNQUNqRSxJQUVBekIsRUFBRVUsVUFBVU8sR0FBRyxRQUFTLG1CQUFtQixTQUFTQyxHQUNoREEsRUFBRVEsaUJBQ0drQyxRQUFRQyxXQUFXQyxhQUNwQjlELEVBQUVvQixNQUFNRSxRQUFRLDhCQUE4QjZDLFFBRXRELEdBRUgsQ0E1VUQsQ0E0VUdDIiwiZmlsZSI6ImFkbWluLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiAoJCkge1xuICAgIFwidXNlIHN0cmljdFwiO1xuXG4gICAgZnVuY3Rpb24gZ2VuTGljZW5zZShsZW5ndGgpIHtcbiAgICAgICAgdmFyIHJlc3VsdCA9IFwiXCI7XG4gICAgICAgIHZhciBjaGFyYWN0ZXJzID0gJzAxMjM0NTY3ODlhYmNkZWZnaGlqa2xtbm9wcXJzdHV2d3h5eic7XG4gICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIHJlc3VsdCArPSBjaGFyYWN0ZXJzW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGNoYXJhY3RlcnMubGVuZ3RoKV07XG4gICAgICAgIH1cbiAgICAgICAgLy8gcmVzdWx0ID0gcmVzdWx0Lm1hdGNoKC9cXGR7MSw0fS9nKS5qb2luKFwiLVwiKTtcbiAgICAgICAgcmV0dXJuIENyeXB0b0pTLk1ENShcImVtc2hcIiArIG5ldyBEYXRlKCkuZ2V0VGltZSgpICsgcmVzdWx0KS50b1N0cmluZygpO1xuICAgIH1cblxuICAgIGZ1bmN0aW9uIGluaXRTb3J0YWJsZSgpIHtcbiAgICAgICAgLy8gc29ydGFibGVcbiAgICAgICAgaWYgKCAkKCAnLmVtc2gtc29ydGFibGUtd3JhcCcgKS5zb3J0YWJsZSggXCJpbnN0YW5jZVwiICkgKSB7XG5cbiAgICAgICAgICAgICQoICcuZW1zaC1zb3J0YWJsZS13cmFwJyApLnNvcnRhYmxlKCBcInJlZnJlc2hcIiApO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuXG4gICAgICAgICAgICAkKCcuZW1zaC1zb3J0YWJsZS13cmFwJykuc29ydGFibGUoe1xuICAgICAgICAgICAgICAgIGF4aXM6IFwieVwiLFxuICAgICAgICAgICAgICAgIGl0ZW1zOiAnLmVtc2gtc2luZ2xlLXNvcnRhYmxlLWl0ZW06bm90KC5jb3VudGVyLTApJ1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICAkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gICAgICAgIC8vIG9uIGxvYWQsIGNoYW5nZSBtZW51IHVybCB0byB0ZW1wbGF0ZSBncm91cCBjYXRlZ29yeVxuICAgICAgICB2YXIgJGVsID0gJCgnLnRvcGxldmVsX3BhZ2VfZW1zaCB1bCBsaSBhW2hyZWY9XCJhZG1pbi5waHA/cGFnZT1lbXNoLXRlbXBsYXRlLWdyb3VwLWNhdGVnb3J5XCJdJyk7XG5cbiAgICAgICAgaWYgKCAkZWwubGVuZ3RoICYmICRlbC5hdHRyKCdocmVmJykuaW5jbHVkZXMoJ2NhdGVnb3J5JykgKSB7XG4gICAgICAgICAgICAkZWwuYXR0cignaHJlZicsICdlZGl0LXRhZ3MucGhwP3RheG9ub215PWVtc2gtdGVtcGxhdGUtZ3JvdXAtY2F0ZWdvcnkmcG9zdF90eXBlPWVtc2gtdGVtcGxhdGUtZ3JvdXBzJyk7XG4gICAgICAgIH1cblxuICAgICAgICBpbml0U29ydGFibGUoKTtcblxuICAgICAgICAvLyBzZWxlY3QyXG4gICAgICAgIGlmICggJC5mbi5zZWxlY3RXb28gKSB7XG5cbiAgICAgICAgICAgICQoJy5lbXNoX211bHRpcGxlJykuc2VsZWN0V29vKCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIE9uIGNoYW5nZSB0ZW1wbGF0ZSB0eXBlIHNlbGVjdG9yIHZhbHVlXG4gICAgJChkb2N1bWVudCkub24oJ2NoYW5nZScsICcudGVtcGxhdGVfdHlwZV9zZWxlY3RvciBzZWxlY3QnLCBmdW5jdGlvbihlKXtcbiAgICAgICAgdmFyIHZhbHVlID0gdGhpcy52YWx1ZTtcbiAgICAgICAgdmFyICRhZG1pbiA9ICQodGhpcykuY2xvc2VzdCgnLmVtc2gtYWRtaW4nKTtcbiAgICAgICAgJGFkbWluLmZpbmQoJy5mb3JtLWdyb3VwOm5vdCgudGVtcGxhdGVfdHlwZV9zZWxlY3RvciknKS5oaWRlKCk7XG4gICAgICAgIGlmICggdmFsdWUgPT09ICdzcGVjaWZpY19jYXRzJyApIHtcbiAgICAgICAgICAgICRhZG1pbi5maW5kKCcuY2F0ZWdvcnlfc2VsZWN0b3InKS5zaG93KCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSBpZiAoIHZhbHVlID09PSAnc3BlY2lmaWNfdGVtcGxhdGVzJyApIHtcbiAgICAgICAgICAgICRhZG1pbi5maW5kKCcudGVtcGxhdGVfc2VsZWN0b3InKS5zaG93KCk7XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgIC8vIE9uIGNsaWNrIGdlbmVyYXRlIGxpY2Vuc2Uga2V5XG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJ2J1dHRvbi5saWNlbnNlLWdlbmVyYXRvcicsIGZ1bmN0aW9uIChlKSB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyIG5ld0xpY2Vuc2UgPSBnZW5MaWNlbnNlKDE2KTtcbiAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5maW5kKCcjbGljZW5zZV9rZXknKS52YWwobmV3TGljZW5zZSk7XG4gICAgfSk7XG5cbiAgICAvLyBPbiBjbGljayBjb3B5IGxpY2Vuc2Uga2V5XG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5jcHktYnRuJywgZnVuY3Rpb24oZSl7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyICRpbnB1dCA9ICQodGhpcykucGFyZW50KCkuZmluZCgnI2xpY2Vuc2Vfa2V5Jyk7XG4gICAgICAgIHZhciBsaWNlbnNlID0gJGlucHV0LnZhbCgpO1xuICAgICAgICAkaW5wdXRbMF0uZm9jdXMoKTtcbiAgICAgICAgJGlucHV0WzBdLnNlbGVjdCgpO1xuICAgICAgICBuYXZpZ2F0b3IuY2xpcGJvYXJkLndyaXRlVGV4dChsaWNlbnNlKTtcbiAgICB9KTtcblxuICAgIGZ1bmN0aW9uIGlzT2JqZWN0KHZhbCkge1xuICAgICAgICBpZiAodmFsID09PSBudWxsKSB7IHJldHVybiBmYWxzZTt9XG4gICAgICAgIHJldHVybiAoICh0eXBlb2YgdmFsID09PSAnZnVuY3Rpb24nKSB8fCAodHlwZW9mIHZhbCA9PT0gJ29iamVjdCcpICk7XG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2xpY2tfb25fc2F2ZV9vcl9wdWJsaXNoKCkge1xuICAgICAgICBpZiAoICQoJ2lucHV0W3R5cGU9c3VibWl0XVtuYW1lPVwicHVibGlzaFwiXScpLmxlbmd0aCApIHtcbiAgICBcbiAgICAgICAgICAgICQoJ2lucHV0W3R5cGU9c3VibWl0XVtuYW1lPVwicHVibGlzaFwiXScpLmNsaWNrKCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkKCdpbnB1dFt0eXBlPXN1Ym1pdF1bbmFtZT1cInNhdmVcIl0nKS5jbGljaygpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5jb25uZWN0LWJ0bicsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIHZhciAkdGhpcyA9ICQodGhpcyk7XG4gICAgICAgICQoJy5lbXNoLW5vdGljZScpLmhpZGUoKTtcbiAgICAgICAgXG5cbiAgICAgICAgaWYgKCR0aGlzLmF0dHIoJ2RhdGEtc3RhdHVzJykgPT09ICcnIHx8ICR0aGlzLmF0dHIoJ2RhdGEtc3RhdHVzJykgPT09ICdub3Rjb25uZWN0ZWQnICkge1xuICAgICAgICAgICAgLy8gbm90IGNvbm5lY3RlZCwgc28gdHJ5IHRvIGNvbm5lY3QuXG5cbiAgICAgICAgICAgIGlmICggJCgnI2Vtc2hfc2l0ZV9saWNlbnNlX2tleScpLnZhbCgpICYmICQoJyNlbXNoX3NpdGVfdXJsJykudmFsKCkgKSB7XG5cbiAgICAgICAgICAgICAgICAkdGhpcy5odG1sKCR0aGlzLmF0dHIoJ2RhdGEtY29ubmVjdGluZycpKTtcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2Vtc2hfY29ubmVjdCcsXG4gICAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiAkKCcjZW1zaF9zaXRlX2xpY2Vuc2Vfa2V5JykudmFsKCksXG4gICAgICAgICAgICAgICAgICAgIHNpdGVfdXJsOiAkKCcjZW1zaF9zaXRlX3VybCcpLnZhbCgpLFxuICAgICAgICAgICAgICAgIH07XG4gICAgXG4gICAgXG4gICAgICAgICAgICAgICAgJHRoaXMuYXR0cignZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAkLnBvc3QoYWpheHVybCwgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgKCdzdWNjZXNzJyBpbiByZXNwb25zZSkgJiYgcmVzcG9uc2Uuc3VjY2VzcyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGNvbm5lY3Rpb24gc3VjY2Vzc2Z1bFxuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuaHRtbCgkdGhpcy5hdHRyKCdkYXRhLWRpc2Nvbm5lY3QnKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkdGhpcy5hdHRyKCdkYXRhLXN0YXR1cycsICdjb25uZWN0ZWQnKTtcbiAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5lbXNoLW5vdGljZScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5lbXNoLW5vdGljZS5ub3RpY2Utc3VjY2VzcycpLmh0bWwocmVzcG9uc2UubWVzc2FnZSkuc2hvdygpO1xuICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnaW5wdXRbbmFtZT1cImVtc2hfY29ubmVjdGlvbl9zdGF0dXNcIl0nKS52YWwoJ2Nvbm5lY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKCAnZXhwaXJ5X2RhdGUnIGluIHJlc3BvbnNlICkge1xuXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnaW5wdXRbbmFtZT1cImVtc2hfc2l0ZV9leHBpcnlfZGF0ZVwiXScpLnZhbChyZXNwb25zZS5leHBpcnlfZGF0ZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrX29uX3NhdmVfb3JfcHVibGlzaCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmFpbGVkIGNvbm5lY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmh0bWwoJHRoaXMuYXR0cignZGF0YS1jb25uZWN0JykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuYXR0cignZGF0YS1zdGF0dXMnLCAnbm90Y29ubmVjdGVkJyk7XG4gICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGlzT2JqZWN0KHJlc3BvbnNlKSAmJiAoJ21lc3NhZ2UnIGluIHJlc3BvbnNlKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuZW1zaC1ub3RpY2UnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmVtc2gtbm90aWNlLm5vdGljZS1lcnJvcicpLmh0bWwocmVzcG9uc2UubWVzc2FnZSkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnaW5wdXRbbmFtZT1cImVtc2hfY29ubmVjdGlvbl9zdGF0dXNcIl0nKS52YWwoJ25vdGNvbm5lY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuYXR0cignZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAvLyBhbHJlYWR5IGNvbm5lY3RlZC4gc28gdHJ5IHRvIGRpc2Nvbm5lY3RcbiAgICAgICAgICAgIGlmICggJCgnI2Vtc2hfc2l0ZV9saWNlbnNlX2tleScpLnZhbCgpICYmICQoJyNlbXNoX3NpdGVfdXJsJykudmFsKCkgKSB7XG5cbiAgICAgICAgICAgICAgICAkdGhpcy5odG1sKCR0aGlzLmF0dHIoJ2RhdGEtZGlzY29ubmVjdGluZycpKTtcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2Vtc2hfZGlzY29ubmVjdCcsXG4gICAgICAgICAgICAgICAgICAgIGxpY2Vuc2Vfa2V5OiAkKCcjZW1zaF9zaXRlX2xpY2Vuc2Vfa2V5JykudmFsKCksXG4gICAgICAgICAgICAgICAgICAgIHNpdGVfdXJsOiAkKCcjZW1zaF9zaXRlX3VybCcpLnZhbCgpLFxuICAgICAgICAgICAgICAgIH07XG4gICAgXG4gICAgICAgICAgICAgICAgJHRoaXMuYXR0cignZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgXG4gICAgICAgICAgICAgICAgJC5wb3N0KGFqYXh1cmwsIGRhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmICgnc3VjY2VzcycgaW4gcmVzcG9uc2UpICYmIHJlc3BvbnNlLnN1Y2Nlc3MgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyBjb25uZWN0aW9uIHN1Y2Nlc3NmdWxcbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmh0bWwoJHRoaXMuYXR0cignZGF0YS1jb25uZWN0JykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuYXR0cignZGF0YS1zdGF0dXMnLCAnbm90Y29ubmVjdGVkJyk7XG4gICAgXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuZW1zaC1ub3RpY2UnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuZW1zaC1ub3RpY2Uubm90aWNlLXN1Y2Nlc3MnKS5odG1sKHJlc3BvbnNlLm1lc3NhZ2UpLnNob3coKTtcbiAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2lucHV0W25hbWU9XCJlbXNoX2Nvbm5lY3Rpb25fc3RhdHVzXCJdJykudmFsKCdub3Rjb25uZWN0ZWQnKTtcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJ2lucHV0W25hbWU9XCJlbXNoX3NpdGVfZXhwaXJ5X2RhdGVcIl0nKS52YWwoJycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGlja19vbl9zYXZlX29yX3B1Ymxpc2goKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIFxuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmFpbGVkIGRpc2Nvbm5lY3Rpb25cbiAgICAgICAgICAgICAgICAgICAgICAgICR0aGlzLmh0bWwoJHRoaXMuYXR0cignZGF0YS1kaXNjb25uZWN0JykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRoaXMuYXR0cignZGF0YS1zdGF0dXMnLCAnY29ubmVjdGVkJyk7XG4gICAgXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGlzT2JqZWN0KHJlc3BvbnNlKSAmJiAoJ21lc3NhZ2UnIGluIHJlc3BvbnNlKSApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuZW1zaC1ub3RpY2UnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgJCgnLmVtc2gtbm90aWNlLm5vdGljZS1lcnJvcicpLmh0bWwocmVzcG9uc2UubWVzc2FnZSkuc2hvdygpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgJCgnaW5wdXRbbmFtZT1cImVtc2hfY29ubmVjdGlvbl9zdGF0dXNcIl0nKS52YWwoJ2Nvbm5lY3RlZCcpO1xuICAgICAgICAgICAgICAgICAgICB9XG5cbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuYXR0cignZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBcbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuc2VydmVyLWRpc2Nvbm5lY3QnLCBmdW5jdGlvbihlKXtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAoIGNvbmZpcm0oZW1zaF9hZG1pbi5hcmV5b3VzdXJlKSApIHtcblxuICAgICAgICAgICAgaWYgKCAkKCcjbGljZW5zZV9rZXknKS52YWwoKSApIHtcbiAgICAgICAgICAgICAgICAkKCcuZW1zaC1ub3RpY2UnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgJGxpID0gJHRoaXMucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgdmFyIHVybCA9ICRsaS5maW5kKCdhJykuaHRtbCgpO1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdlbXNoX3Jldm9rZV9zaXRlJyxcbiAgICAgICAgICAgICAgICAgICAgc2l0ZV91cmw6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6ICQoJyNsaWNlbnNlX2tleScpLnZhbCgpXG4gICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgICR0aGlzLmF0dHIoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgJC5wb3N0KGFqYXh1cmwsIGRhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmICgnc3VjY2VzcycgaW4gcmVzcG9uc2UpICYmIHJlc3BvbnNlLnN1Y2Nlc3MgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyByZXZva2luZyBzdWNjZXNzZnVsXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGlja19vbl9zYXZlX29yX3B1Ymxpc2goKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZhaWxlZCB0byByZXZva2VcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNob3cgZXJyb3Igbm90aWNlXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuZW1zaC1ub3RpY2UnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGlzT2JqZWN0KHJlc3BvbnNlKSAmJiAoJ21lc3NhZ2UnIGluIHJlc3BvbnNlKSApIHtcbiAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuZW1zaC1ub3RpY2Uubm90aWNlLWVycm9yJykuaHRtbChyZXNwb25zZS5tZXNzYWdlKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuYXR0cignZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0gICAgXG4gICAgfSk7XG4gICAgXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5zZXJ2ZXItYmxvY2suZGlzYWJsZWQnLCBmdW5jdGlvbihlKXtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgIH0pO1xuXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5zZXJ2ZXItYmxvY2s6bm90KC5kaXNhYmxlZCknLCBmdW5jdGlvbihlKXtcbiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICBpZiAoIGNvbmZpcm0oZW1zaF9hZG1pbi5hcmV5b3VzdXJlKSApIHtcblxuICAgICAgICAgICAgaWYgKCAkKCcjbGljZW5zZV9rZXknKS52YWwoKSApIHtcbiAgICAgICAgICAgICAgICAkKCcuZW1zaC1ub3RpY2UnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgdmFyICR0aGlzID0gJCh0aGlzKTtcbiAgICAgICAgICAgICAgICB2YXIgJGxpID0gJHRoaXMucGFyZW50KCk7XG4gICAgICAgICAgICAgICAgdmFyIHVybCA9ICRsaS5maW5kKCdhJykuaHRtbCgpO1xuICAgICAgICAgICAgICAgIHZhciBkYXRhID0ge1xuICAgICAgICAgICAgICAgICAgICBhY3Rpb246ICdlbXNoX2Jsb2NrX3NpdGUnLFxuICAgICAgICAgICAgICAgICAgICBzaXRlX3VybDogdXJsLFxuICAgICAgICAgICAgICAgICAgICBsaWNlbnNlX2tleTogJCgnI2xpY2Vuc2Vfa2V5JykudmFsKClcbiAgICAgICAgICAgICAgICB9XG4gICAgXG4gICAgICAgICAgICAgICAgJHRoaXMuYXR0cignZGlzYWJsZWQnLCB0cnVlKTtcbiAgICAgICAgICAgICAgICAkLnBvc3QoYWpheHVybCwgZGF0YSwgZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzcG9uc2UgJiYgKCdzdWNjZXNzJyBpbiByZXNwb25zZSkgJiYgcmVzcG9uc2Uuc3VjY2VzcyApIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHJldm9raW5nIHN1Y2Nlc3NmdWxcbiAgICAgICAgICAgICAgICAgICAgICAgIGNsaWNrX29uX3NhdmVfb3JfcHVibGlzaCgpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gZmFpbGVkIHRvIHJldm9rZVxuICAgICAgICAgICAgICAgICAgICAgICAgLy8gc2hvdyBlcnJvciBub3RpY2VcbiAgICAgICAgICAgICAgICAgICAgICAgICQoJy5lbXNoLW5vdGljZScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICggaXNPYmplY3QocmVzcG9uc2UpICYmICgnbWVzc2FnZScgaW4gcmVzcG9uc2UpICkge1xuICAgIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICQoJy5lbXNoLW5vdGljZS5ub3RpY2UtZXJyb3InKS5odG1sKHJlc3BvbnNlLm1lc3NhZ2UpLnNob3coKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgICAgICAkdGhpcy5hdHRyKCdkaXNhYmxlZCcsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy5zZXJ2ZXItdW5ibG9jaycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmICggY29uZmlybShlbXNoX2FkbWluLmFyZXlvdXN1cmUpICkge1xuXG4gICAgICAgICAgICBpZiAoICQoJyNsaWNlbnNlX2tleScpLnZhbCgpICkge1xuICAgICAgICAgICAgICAgICQoJy5lbXNoLW5vdGljZScpLmhpZGUoKTtcbiAgICAgICAgICAgICAgICB2YXIgJHRoaXMgPSAkKHRoaXMpO1xuICAgICAgICAgICAgICAgIHZhciAkbGkgPSAkdGhpcy5wYXJlbnQoKTtcbiAgICAgICAgICAgICAgICB2YXIgdXJsID0gJGxpLmZpbmQoJ2EnKS5odG1sKCk7XG4gICAgICAgICAgICAgICAgdmFyIGRhdGEgPSB7XG4gICAgICAgICAgICAgICAgICAgIGFjdGlvbjogJ2Vtc2hfdW5ibG9ja19zaXRlJyxcbiAgICAgICAgICAgICAgICAgICAgc2l0ZV91cmw6IHVybCxcbiAgICAgICAgICAgICAgICAgICAgbGljZW5zZV9rZXk6ICQoJyNsaWNlbnNlX2tleScpLnZhbCgpXG4gICAgICAgICAgICAgICAgfVxuICAgIFxuICAgICAgICAgICAgICAgICR0aGlzLmF0dHIoJ2Rpc2FibGVkJywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgJC5wb3N0KGFqYXh1cmwsIGRhdGEsIGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3BvbnNlICYmICgnc3VjY2VzcycgaW4gcmVzcG9uc2UpICYmIHJlc3BvbnNlLnN1Y2Nlc3MgKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAvLyByZXZva2luZyBzdWNjZXNzZnVsXG4gICAgICAgICAgICAgICAgICAgICAgICBjbGlja19vbl9zYXZlX29yX3B1Ymxpc2goKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIGZhaWxlZCB0byByZXZva2VcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHNob3cgZXJyb3Igbm90aWNlXG4gICAgICAgICAgICAgICAgICAgICAgICAkKCcuZW1zaC1ub3RpY2UnKS5oaWRlKCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoIGlzT2JqZWN0KHJlc3BvbnNlKSAmJiAoJ21lc3NhZ2UnIGluIHJlc3BvbnNlKSApIHtcbiAgICBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAkKCcuZW1zaC1ub3RpY2Uubm90aWNlLWVycm9yJykuaHRtbChyZXNwb25zZS5tZXNzYWdlKS5zaG93KCk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICBcbiAgICAgICAgICAgICAgICAgICAgJHRoaXMuYXR0cignZGlzYWJsZWQnLCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICB9KTtcblxuICAgICQoZG9jdW1lbnQpLm9uKCdjbGljaycsICcuYWRkc29ydGFibGVpdGVtJywgZnVuY3Rpb24oZSl7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgdmFyICRuZXdFbGVtZW50ID0gJCh0aGlzKS5wYXJlbnQoKS5maW5kKCcuZW1zaC1zaW5nbGUtc29ydGFibGUtaXRlbTpsYXN0JykuY2xvbmUoKVxuICAgICAgICAkbmV3RWxlbWVudC5hcHBlbmRUbygkKCcuZW1zaC1zb3J0YWJsZS13cmFwJykpLnJlbW92ZUNsYXNzKCdjb3VudGVyLTAnKS5maW5kKCcudXJsLWRhdGEgYScpLmhpZGUoKTtcbiAgICAgICAgJG5ld0VsZW1lbnQuZmluZCgnLnRnLWRlbGV0ZS1pdGVtJykuc2hvdygpO1xuICAgICAgICAkbmV3RWxlbWVudC5maW5kKCdpbnB1dCcpLnZhbCgnJyk7XG5cbiAgICAgICAgaW5pdFNvcnRhYmxlKCk7XG4gICAgfSk7XG5cbiAgICAkKGRvY3VtZW50KS5vbignY2hhbmdlJywgJyNlbXNoX3RlbXBsYXRlX2dyb3VwX3RlbXBsYXRlcycsIGZ1bmN0aW9uKGUpe1xuICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoJy51cmwtZGF0YSBhJykuaGlkZSgpO1xuICAgICAgICAkKHRoaXMpLnBhcmVudCgpLmZpbmQoJy51cmwtZGF0YSBhW2RhdGEtaWQ9Jyt0aGlzLnZhbHVlKyddJykuc2hvdygpO1xuICAgIH0pO1xuXG4gICAgJChkb2N1bWVudCkub24oJ2NsaWNrJywgJy50Zy1kZWxldGUtaXRlbScsIGZ1bmN0aW9uKGUpe1xuICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICAgIGlmICggY29uZmlybShlbXNoX2FkbWluLmFyZXlvdXN1cmUpICkge1xuICAgICAgICAgICAgJCh0aGlzKS5jbG9zZXN0KCcuZW1zaC1zaW5nbGUtc29ydGFibGUtaXRlbScpLnJlbW92ZSgpO1xuICAgICAgICB9XG4gICAgfSk7XG5cbn0pKGpRdWVyeSk7Il19